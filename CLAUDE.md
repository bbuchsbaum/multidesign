# multidesign R Package

## Overview

The `multidesign` package provides tools for managing complex experimental designs and multi-block data structures. It implements methods for design matrix manipulation, cross-validation, and data splitting with support for lazy evaluation and memory-efficient processing. The package integrates with the tidyverse ecosystem and extends functionality of tibble and dplyr for experimental design workflows.

**Author**: Bradley R. Buchsbaum  
**Version**: 0.1.0  
**License**: MIT  
**GitHub**: https://github.com/bbuchsbaum/multidesign

## Core Data Structures

The package provides four main data structures for different experimental design scenarios:

### 1. `multidesign`
- Combines experimental data (matrix) with design information (data frame)
- Maintains relationships between observations and experimental conditions
- Supports optional column metadata for variables
- Core components: data matrix `x`, design tibble, and optional `column_design`

### 2. `hyperdesign` 
- Collection of multiple `multidesign` objects
- Used for multi-group, multi-block, or multi-view datasets
- Ideal for multiple subjects, sessions, or data modalities
- Maintains block structure and indices

### 3. `multiframe`
- Similar to `multidesign` but with enhanced tidyverse integration
- Supports lazy evaluation of observations (loaded only when needed)
- Provides flexible interface for data manipulation
- Better integration with dplyr/tidyr workflows

### 4. `multiblock`
- Handles stacked submatrices sharing row or column dimensions
- Automatically determines row-stacked vs column-stacked orientation
- Preserves block structure information
- Useful for multi-block statistical analysis

## Key Features

- **Lazy Evaluation**: Observations are loaded on-demand for memory efficiency
- **Cross-validation Support**: Built-in methods for creating stratified CV folds
- **Tidyverse Integration**: Works seamlessly with dplyr, tibble, and tidyr
- **Flexible Data Splitting**: Split data by design variables while preserving structure
- **Multi-block Analysis**: Handle complex multi-block and multi-view datasets
- **Memory Efficient**: Avoid data duplication through intelligent indexing

## Package Structure

```
multidesign/
├── DESCRIPTION          # Package metadata and dependencies
├── NAMESPACE           # Exported functions and imports (auto-generated)
├── LICENSE             # MIT license
├── README.md           # Package overview
├── _pkgdown.yml        # Documentation website config
├── .Rbuildignore       # Files to ignore during R package build
├── multidesign.Rproj   # RStudio project file
├── R/                  # Main source code
│   ├── all_generic.R   # Generic function definitions
│   ├── multidesign.R   # multidesign class implementation
│   ├── hyperdesign.R   # hyperdesign class implementation
│   ├── multiframe.R    # multiframe class implementation
│   └── multiblock.R    # multiblock class implementation
├── man/                # Documentation files (auto-generated by roxygen2)
├── tests/              # Unit tests
│   ├── testthat.R      # Test runner
│   └── testthat/       # Test files
│       ├── test-multidesign.R
│       ├── test-hyperdesign.R
│       ├── test-multiframe.R
│       └── test-multiblock.R
└── vignettes/          # Package vignettes
    └── Introduction.Rmd
```

## Dependencies

### Core Dependencies
- **chk**: Argument checking and validation
- **tibble**: Enhanced data frames
- **dplyr**: Data manipulation grammar
- **multivarious**: Multivariate analysis foundation
- **crayon**: Colored terminal output
- **deflist**: Deferred list operations
- **purrr**: Functional programming tools
- **tidyr**: Data tidying
- **magrittr**: Pipe operator
- **recipes**: Data preprocessing
- **stats, utils, rlang**: Base R functionality

### Development Dependencies
- **testthat**: Unit testing framework
- **covr**: Test coverage analysis
- **knitr**: Document generation

## Development Workflow

### Tools Used
- **RStudio**: Primary IDE (BuildType: Package, UseDevtools: Yes)
- **devtools**: Package development tools
- **roxygen2**: Documentation generation (version 7.3.2)
- **testthat**: Unit testing (edition 3)
- **aider**: AI-assisted development (visible in commit history)
- **pkgdown**: Documentation website generation

### Common Development Commands

```r
# Install and load development tools
library(devtools)

# Load package for development
load_all()

# Generate documentation
document()

# Run tests
test()

# Check package
check()

# Install package
install()

# Build package
build()

# Generate website
pkgdown::build_site()
```

### Testing
- Uses testthat framework (edition 3)
- Tests organized by main class (`test-multidesign.R`, etc.)
- Run tests with `devtools::test()` or `testthat::test_check("multidesign")`

### Documentation
- Uses roxygen2 for inline documentation
- Run `devtools::document()` to update man pages
- Vignettes written in R Markdown
- pkgdown for website generation

## Git Workflow

The package uses a standard git workflow with:
- Main branch: `master`
- Recent commits show use of aider for AI-assisted development
- Conventional commit messages for some commits
- Integration with GitHub for issue tracking

## Build and Install

```bash
# From R console
devtools::install_github("bbuchsbaum/multidesign")

# Or clone and install locally
git clone https://github.com/bbuchsbaum/multidesign.git
cd multidesign
R CMD INSTALL .

# Or using devtools
devtools::install()
```

## Usage Examples

```r
library(multidesign)
library(tibble)

# Create sample data
X <- matrix(rnorm(20*100), 20, 100)
Y <- tibble(
  condition = rep(c("control", "treatment"), each=10),
  subject = rep(1:5, times=4)
)

# Create multidesign object
mds <- multidesign(X, Y)

# Split by condition
split_data <- split(mds, condition)

# Create cross-validation folds
cv_folds <- fold_over(mds, condition)

# Summarize by condition
condition_means <- summarize_by(mds, colMeans, condition)
```

## Key Exported Functions

- `multidesign()`: Create multidesign objects
- `hyperdesign()`: Create hyperdesign objects  
- `multiframe()`: Create multiframe objects
- `multiblock()`: Create multiblock objects
- `fold_over()`: Generate cross-validation folds
- `summarize_by()`: Group-wise summarization
- `split_indices()`: Split indices by variables
- `xdata()`: Extract data matrices
- `design()`: Extract design information
- `column_design()`: Extract column metadata
- `observation()`: Create observation objects
- `obs_group()`: Create observation groups

## Related Packages

- **multivarious**: Provides foundation for multivariate analysis
- **tidyverse**: Data manipulation and visualization ecosystem
- **recipes**: Data preprocessing and feature engineering
- **rsample**: Resampling and cross-validation (complementary approach)